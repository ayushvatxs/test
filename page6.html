<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VIOLINA DATABASE | REASSEMBLY</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        /* --- CORE RESET --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: #050505; color: #fff;
            font-family: 'Share Tech Mono', monospace;
            overflow: hidden; height: 100vh; width: 100vw;
            perspective: 1000px;
        }

        :root {
            --pink: #ff003c;
            --neon-pink: #ff3399;
        }

        /* --- BACKGROUNDS --- */
        .bg-stars {
            position: absolute; inset: 0; z-index: -1;
            background-image: radial-gradient(white 1px, transparent 1px);
            background-size: 50px 50px; opacity: 0.1;
        }
        .vignette {
            position: fixed; inset: 0; z-index: 10; pointer-events: none;
            background: radial-gradient(circle at center, transparent 30%, #000 100%);
        }

        /* --- TEXT LAYER --- */
        #cmd-text {
            position: absolute; top: 20%; left: 50%; transform: translateX(-50%);
            font-family: 'Orbitron'; font-size: 1.2rem; letter-spacing: 4px;
            color: var(--pink); text-shadow: 0 0 10px var(--pink);
            z-index: 100; text-align: center; transition: opacity 0.5s;
        }

        /* --- THE PARTICLE IMAGE CONTAINER --- */
        #particle-image-wrap {
            position: absolute; top: 50%; left: 50%; 
            width: 350px; height: 450px; 
            transform: translate(-50%, -50%);
            z-index: 60;
            opacity: 0; transition: opacity 0.5s;
        }

        /* SINGLE IMAGE PARTICLE STYLE */
        .img-p {
            position: absolute;
            width: 2px; height: 2px;
            background-color: var(--p-color);
            box-shadow: 0 0 2px var(--p-color); /* Subtle glow */
            border-radius: 50%;
            
            /* Start Randomly Off Screen */
            left: var(--startX); top: var(--startY);
            opacity: 0; transform: scale(0.1);

            /* The fly-in animation config */
            transition: all 3s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: left, top, opacity, transform;
        }

        /* ASSEMBLED STATE */
        #particle-image-wrap.assembled .img-p {
            left: var(--targetX) !important;
            top: var(--targetY) !important;
            opacity: 1; transform: scale(1);
        }
        
        /* Breathing effect */
        #particle-image-wrap.assembled {
            animation: imageBreathe 5s ease-in-out infinite alternate;
        }

        /* Rings around the image */
        .h-ring {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            border: 1px solid var(--pink); border-radius: 50%; opacity: 0; pointer-events: none; z-index: 55; transition: opacity 1s;
        }
        .hr1 { width: 500px; height: 500px; border-style: dashed; animation: spin 40s linear infinite; }
        .hr2 { width: 600px; height: 600px; border: 1px solid rgba(255,0,60,0.3); animation: pulseRing 2s infinite; }

        /* --- FOOTER UI --- */
        #footer-ui {
            position: absolute; bottom: 50px; width: 100%; text-align: center;
            opacity: 0; transition: opacity 2s; z-index: 100;
        }
        .final-status {
            font-family: 'Orbitron'; font-size: 1.5rem; font-weight: bold;
            color: #fff; text-shadow: 0 0 20px var(--pink); margin-bottom: 10px;
        }
        .sub-status { font-size: 0.8rem; color: var(--pink); letter-spacing: 2px; }

        #flash { position: fixed; inset: 0; background: #fff; z-index: 9999; opacity: 0; pointer-events: none; }

        /* ANIMATIONS */
        @keyframes imageBreathe {
            0% { filter: brightness(1); transform: translate(-50%, -50%) scale(1); }
            100% { filter: brightness(1.2); transform: translate(-50%, -50%) scale(1.02); }
        }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        @keyframes pulseRing { 0% { transform: translate(-50%, -50%) scale(0.9); opacity: 0.2; } 50% { opacity: 0.6; } 100% { transform: translate(-50%, -50%) scale(1.1); opacity: 0; } }
        @keyframes flashAnim { 0% { opacity: 1; } 100% { opacity: 0; } }

    </style>
</head>
<body>

    <div class="bg-stars"></div>
    <div class="vignette"></div>
    <div id="flash"></div>

    <div id="cmd-text">WAITING FOR REASSEMBLY...</div>

    <div class="h-ring hr1" id="ring1"></div>
    <div class="h-ring hr2" id="ring2"></div>

    <div id="particle-image-wrap"></div>

    <div id="footer-ui">
        <div class="final-status">SYSTEM STATUS: ETERNAL</div>
        <div class="sub-status">PROJECT VIOLINA: SUCCESSFULLY RESTORED</div>
    </div>

    <script>
        const sounds = {
            vacuum: new Audio('sfx_vacuum.mp3'),
            impact: new Audio('sfx_impact.mp3'),
            heart: new Audio('sfx_heartbeat.mp3')
        };
        sounds.heart.loop = true;

        const cmd = document.getElementById('cmd-text');
        const particleWrap = document.getElementById('particle-image-wrap');

        // --- IMAGE PROCESSING ENGINE ---
        function processImageAndCreateParticles(imagePath) {
            const img = new Image();
            img.src = imagePath;
            img.crossOrigin = "Anonymous"; // Fix for some local server issues
            
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Scale down for performance (High particle count = lag)
                // 200px width provides approx 3000-4000 particles which is perfect
                const canvasWidth = 200; 
                const canvasHeight = canvasWidth * (img.height / img.width);
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;

                ctx.drawImage(img, 0, 0, canvasWidth, canvasHeight);
                const imgData = ctx.getImageData(0, 0, canvasWidth, canvasHeight).data;
                
                // Sampling rate (Density of particles)
                const sampleRate = 3; 

                for(let y = 0; y < canvasHeight; y += sampleRate) {
                    for(let x = 0; x < canvasWidth; x += sampleRate) {
                        const index = (y * canvasWidth + x) * 4;
                        const r = imgData[index];
                        const g = imgData[index + 1];
                        const b = imgData[index + 2];
                        const a = imgData[index + 3];

                        // Brightness Check: Only create particles for visible parts
                        // This removes the dark background, creating the hologram effect
                        if (a > 128 && (r + g + b) / 3 > 20) {
                            const p = document.createElement('div');
                            p.className = 'img-p';

                            // Color Logic: Mix image color with Neon Pink for the "Tech" look
                            // We boost the Red channel slightly to ensure it fits the theme
                            p.style.setProperty('--p-color', `rgb(${r}, ${g}, ${b})`);

                            // Target Position (Relative %)
                            const targetXPercent = (x / canvasWidth) * 100;
                            const targetYPercent = (y / canvasHeight) * 100;
                            p.style.setProperty('--targetX', targetXPercent + '%');
                            p.style.setProperty('--targetY', targetYPercent + '%');

                            // Random Start Position (Off Screen Explosion)
                            const angle = Math.random() * Math.PI * 2;
                            const dist = 150; // Distance off screen
                            const startX = (Math.cos(angle) * dist) + 50 + 'vw'; 
                            const startY = (Math.sin(angle) * dist) + 50 + 'vh';
                            p.style.setProperty('--startX', startX);
                            p.style.setProperty('--startY', startY);
                            
                            // Random arrival delay for "swarming" effect
                            p.style.transitionDelay = (Math.random() * 1.5) + 's';

                            particleWrap.appendChild(p);
                        }
                    }
                }
                startSequence();
            };
            
            img.onerror = () => {
                cmd.innerText = "IMAGE ERROR: CHECK FILE NAME";
                cmd.style.color = "red";
            }
        }

        function startSequence() {
            setTimeout(() => {
                cmd.innerText = "GATHERING FRAGMENTS...";
            }, 1000);

            setTimeout(() => {
                // START VACUUM
                sounds.vacuum.play().catch(()=>{});
                cmd.innerText = "RECONSTRUCTING CORE MEMORY...";
                
                // Show container
                particleWrap.style.opacity = '1';
                // Trigger Assemble
                particleWrap.classList.add('assembled');
                
                // Fade in Rings
                document.getElementById('ring1').style.opacity = '0.5';
                document.getElementById('ring2').style.opacity = '0.5';

            }, 2500);

            setTimeout(() => {
                // IMPACT (Particles Snap)
                sounds.vacuum.pause();
                sounds.impact.play().catch(()=>{});
                
                // Flash
                const f = document.getElementById('flash');
                f.style.animation = 'flashAnim 2s forwards';

                // Hide Text
                cmd.style.opacity = '0';
                
            }, 5500); // Wait for particles to arrive

            setTimeout(() => {
                // ALIVE
                sounds.heart.play().catch(()=>{});
                document.getElementById('footer-ui').style.opacity = '1';
            }, 6000);
        }

        window.onload = () => {
            // REMEMBER TO RENAME THE FILE TO violina_main.jpg
            processImageAndCreateParticles('violina_main.jpg');
        };

    </script>
</body>
</html>
